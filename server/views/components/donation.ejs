<%
  const localeKey = block?.locale || 'de';
  const defaultsByLocale = {
    de: {
      headline: 'Spenden',
      description: 'Möchtest du spenden und unser Festival unterstützen?',
      amountTitle: 'Wähle deinen Betrag:',
      customLabel: 'eigener Betrag',
      customPlaceholder: 'Betrag eingeben',
      personalTitle: 'Persönliche Angaben:',
      addressTitle: 'Adresse:',
      firstNameLabel: 'Vorname',
      lastNameLabel: 'Nachname',
      emailLabel: 'E-Mail',
      streetLabel: 'Straße & Hausnummer',
      postalCodeLabel: 'PLZ',
      cityLabel: 'Stadt',
      countryLabel: 'Land',
      submitLabel: 'Spenden',
      closingText: 'Im Anschluss daran erhältst du eine Spendenquittung per Mail zugesandt.'
    },
    en: {
      headline: 'Donate',
      description: 'Would you like to donate and support our festival?',
      amountTitle: 'Choose your amount:',
      customLabel: 'custom amount',
      customPlaceholder: 'Enter amount',
      personalTitle: 'Personal info:',
      addressTitle: 'Address:',
      firstNameLabel: 'First name',
      lastNameLabel: 'Last name',
      emailLabel: 'Email',
      streetLabel: 'Street & house number',
      postalCodeLabel: 'Postal code',
      cityLabel: 'City',
      countryLabel: 'Country',
      submitLabel: 'Donate',
      closingText: 'You will receive a donation receipt via email afterwards.'
    },
    ku: {
      headline: 'Bexş',
      description: 'Tu dixwazî bexşînî û festîvala me piştgirî bikî?',
      amountTitle: 'Bêxşê xwe hilbijêre:',
      customLabel: 'mîqdara xweser',
      customPlaceholder: 'Mîqdar binivîse',
      personalTitle: 'Agahiyên şahsî:',
      addressTitle: 'Navnîşan:',
      firstNameLabel: 'Nav',
      lastNameLabel: 'Paşnav',
      emailLabel: 'E-mail',
      streetLabel: 'Kolan û hejmara malê',
      postalCodeLabel: 'Koda postê',
      cityLabel: 'Bajar',
      countryLabel: 'Welat',
      submitLabel: 'Bexşin',
      closingText: 'Piştî wê, tu wê rêçxistina bexşînê bi e-mail bistînî.'
    }
  };
  const localeDefaults = defaultsByLocale[localeKey] || defaultsByLocale.de;
  const headline = block?.headline || localeDefaults.headline;
  const description = block?.description || localeDefaults.description;
  const amountTitle = block?.amountTitle || localeDefaults.amountTitle;
  const customLabel = block?.customLabel || localeDefaults.customLabel;
  const customPlaceholder = block?.customPlaceholder || localeDefaults.customPlaceholder;
  const personalTitle = block?.personalTitle || localeDefaults.personalTitle;
  const addressTitle = block?.addressTitle || localeDefaults.addressTitle;
  const firstNameLabel = block?.firstNameLabel || localeDefaults.firstNameLabel;
  const lastNameLabel = block?.lastNameLabel || localeDefaults.lastNameLabel;
  const emailLabel = block?.emailLabel || localeDefaults.emailLabel;
  const streetLabel = block?.streetLabel || localeDefaults.streetLabel;
  const postalCodeLabel = block?.postalCodeLabel || localeDefaults.postalCodeLabel;
  const cityLabel = block?.cityLabel || localeDefaults.cityLabel;
  const countryLabel = block?.countryLabel || localeDefaults.countryLabel;
  const submitLabel = block?.submitLabel || localeDefaults.submitLabel;
  const closingText = block?.closingText || localeDefaults.closingText;

  const amounts = Array.isArray(block?.amounts) && block.amounts.length
    ? block.amounts
    : [
        { value: 25, enabled: true },
        { value: 50, enabled: true },
        { value: 75, enabled: true },
        { value: 100, enabled: true }
      ];
  const activeAmounts = amounts
    .filter((amount) => amount?.enabled !== false)
    .map((amount) => ({
      value: Number(amount.value),
      label: amount?.label || ''
    }))
    .filter((amount) => Number.isFinite(amount.value));
%>

<section class="section donation section--align-center" data-component="donation" data-donation>
  <div class="section__inner donation__inner">
    <header class="donation__header">
      <h1 class="donation__title"><%- renderTextWithLinks(headline) %></h1>
      <p class="donation__description"><%- renderTextWithLinks(description) %></p>
    </header>

    <form class="donation__card" action="/api/donations/create" method="post" data-donation-form>
      <div class="donation__amounts">
        <h3 class="donation__subtitle"><%- renderTextWithLinks(amountTitle) %></h3>
        <div class="donation__amount-grid">
          <% activeAmounts.forEach((amount) => { %>
          <button class="donation__amount-button" type="button" data-donation-amount data-amount-value="<%= amount.value %>">
            <%= amount.label || amount.value + '€' %>
          </button>
          <% }) %>
          <button class="donation__amount-button donation__amount-button--custom" type="button" data-donation-custom>
            <%= customLabel %>
          </button>
        </div>
        <div class="donation__custom-field" data-donation-custom-field hidden>
          <input type="number" min="1" inputmode="decimal" name="donation_custom_amount" placeholder="<%= customPlaceholder %>">
        </div>
        <input type="hidden" name="donation_amount" value="">
        <input type="hidden" name="donation_locale" value="<%= localeKey %>">
      </div>

      <div class="donation__personal">
        <h3 class="donation__subtitle"><%- renderTextWithLinks(personalTitle) %></h3>
        <div class="donation__personal-grid">
          <input type="text" name="first_name" placeholder="<%= firstNameLabel %>" required>
          <input type="text" name="last_name" placeholder="<%= lastNameLabel %>" required>
        </div>
        <input type="email" name="email" placeholder="<%= emailLabel %>" required>
      </div>

      <div class="donation__personal">
        <h3 class="donation__subtitle"><%- renderTextWithLinks(addressTitle) %></h3>
        <div class="donation__personal-grid">
          <input type="text" name="address_line1" placeholder="<%= streetLabel %>" required>
          <input type="text" name="postal_code" placeholder="<%= postalCodeLabel %>" required>
        </div>
        <div class="donation__personal-grid">
          <input type="text" name="city" placeholder="<%= cityLabel %>" required>
          <input type="text" name="country" placeholder="<%= countryLabel %>" required>
        </div>
      </div>

      <button class="donation__submit" type="submit">
        <span><%= submitLabel %></span>
        <span aria-hidden="true">✓</span>
      </button>
      <p class="donation__error" data-donation-error hidden></p>
    </form>

    <p class="donation__closing"><%- renderTextWithLinks(closingText) %></p>
  </div>
</section>