<%
  const tickets = Array.isArray(mediaTickets) ? mediaTickets : [];
  const allowedTypes = ['kino', 'online', 'combo'];
  const displayedTickets = tickets.filter((ticket) => allowedTypes.includes(ticket.ticket_type)).slice(0, 3);
  const locale = String(page?.locale || block?.locale || '').toLowerCase();
  const localeKey = locale.startsWith('en') ? 'en' : (locale.startsWith('ku') ? 'ku' : 'de');
  const ticketsLink = `/tickets-${localeKey}`;
    const labels = {
    de: {
      empty: 'Aktuell sind keine Tickets verfügbar.',
      previous: 'Zurück',
      next: 'Weiter',
      cta: 'Alle Tickets ansehen'
    },
    en: {
      empty: 'No tickets are currently available.',
      previous: 'Previous',
      next: 'Next',
      cta: 'View all tickets'
    },
    ku: {
      empty: 'Niha bilêt tune ne.',
      previous: 'Paşve',
      next: 'Pêş',
      cta: 'Hemû bilêtan bibîne'
    }
  };
  const localeLabels = labels[localeKey] || labels.de;
  const formatCurrency = (value) => {
    const numberValue = Number(value);
    if (Number.isNaN(numberValue)) return '';
    return new Intl.NumberFormat('de-DE', {
      style: 'currency',
      currency: 'EUR',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(numberValue);
  };
%>

<section class="section section--align-center ticket-showcase " data-component="ticket-showcase" id="ticket">
  <div class="section__inner ticket-showcase__inner animate-on-scroll">
    <header class="ticket-showcase__header">
      <% if (block?.headline) { %>
      <h2 class="ticket-showcase__title"><%- renderTextWithLinks(block.headline) %></h2>
      <% } %>
      <% if (block?.text) { %>
      <% const leadParagraphs = String(block.text).split(/\r?\n+/).map((paragraph) => paragraph.trim()).filter(Boolean); %>
      <% leadParagraphs.forEach((paragraph) => { %>
      <p class="ticket-showcase__lead"><%- renderTextWithLinks(paragraph) %></p>
      <% }) %>
      <% } %>
    </header>

    <div class="ticket-showcase__content">
      <div class="ticket-showcase__tickets" data-carousel>
        <% if (!displayedTickets.length) { %>
        <div class="ticket-showcase__empty"><%= localeLabels.empty %></div>
        <% } %>
        <% displayedTickets.forEach((ticket, index) => { %>
        <%- include('./ticketCard', { ticket, formatCurrency, isFeatured: index === 1 }) %>
        <% }) %>
      </div>

      <button class="ticket-showcase__scroll-hint ticket-showcase__scroll-hint--left" type="button" data-scroll="left" aria-label="<%= localeLabels.previous %>">
        <svg viewBox="0 0 24 24" focusable="false">
          <path d="M15 5l-7 7 7 7 1.5-1.5L10.5 12 16.5 6.5 15 5z"></path>
        </svg>
      </button>

      <button class="ticket-showcase__scroll-hint ticket-showcase__scroll-hint--right" type="button" data-scroll="right" aria-label="<%= localeLabels.next %>">
        <svg viewBox="0 0 24 24" focusable="false">
          <path d="M9 5l7 7-7 7-1.5-1.5L13 12 7.5 6.5 9 5z"></path>
        </svg>
      </button>

      <div class="ticket-showcase__dots" data-dots aria-hidden="true"></div>
    </div>

    <div class="ticket-showcase__cta">
      <a class="ticket-showcase__cta-button" href="<%= ticketsLink %>">
        <%= localeLabels.cta %> →
      </a>
    </div>
  </div>
</section>