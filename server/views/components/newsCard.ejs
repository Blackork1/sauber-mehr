<%
  const publishedAt = article?.published_at || article?.created_at;
  const publishedTime = publishedAt ? new Date(publishedAt).getTime() : 0;
  const isNew = publishedTime && (Date.now() - publishedTime) <= 7 * 24 * 60 * 60 * 1000;
  const categoryLabel = article?.h2_title || 'News';
  const detailHref = article?.slug || (article?.id ? `/news/${article.id}` : '#');
  const locale = String((typeof localeKey !== 'undefined' ? localeKey : '') || '').toLowerCase();
  const resolvedLocaleKey = locale.startsWith('en') ? 'en' : (locale.startsWith('ku') ? 'ku' : 'de');
    const labels = {
    de: { open: 'Öffnen', expand: 'erweitern', new: 'Neu' },
    en: { open: 'Open', expand: 'Expand', new: 'New' },
    ku: { open: 'Veke', expand: 'Fireh bike', new: 'Nû' }
  };
  const localeLabels = labels[resolvedLocaleKey] || labels.de;
  const dateLocale = resolvedLocaleKey === 'en' ? 'en-US' : (resolvedLocaleKey === 'ku' ? 'ku' : 'de-DE');
%>

<article class="news-card" data-link="<%= detailHref %>">
  <% if (isNew) { %>
  <span class="news-card__badge"><%= localeLabels.new %></span>
  <% } %>
  <div class="news-card__image">
    <% if (article?.title_image_url) { %>
    <% if (article?.title_media_type === 'video') { %>
    <video preload="metadata" muted playsinline>
      <source src="<%= article.title_image_url %>" type="video/mp4">
    </video>
    <% } else { %>
    <img src="<%= article.title_image_url %>" alt="<%= article?.title || 'News Bild' %>">
    <% } %>
    <% } %>
  </div>
  <div class="news-card__body">
    <div class="news-card__textarea"> <span class="news-card__category"><%- renderTextWithLinks(categoryLabel) %></span>
      <h4 class="news-card__title"><%- renderTextWithLinks(article?.title || '') %></h4>
      <p class="news-card__date">
        <%= publishedAt ? new Date(publishedAt).toLocaleDateString(dateLocale) : '' %>
      </p>
      <p class="news-card__text"><%- renderTextWithLinks(article?.description_short || article?.meta_description || '') %></p>
    </div>
    <div class="news-card__actions">
      <a class="news-card__open" href="<%= detailHref %>"><%= localeLabels.open %></a>
      <a class="news-card__more" href="<%= detailHref %>">
        <%= localeLabels.expand %>
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M14 3h7v7h-2V6.4l-9.3 9.3-1.4-1.4 9.3-9.3H14V3z"></path>
          <path d="M5 5h6v2H7v10h10v-4h2v6H5V5z"></path>
        </svg>
      </a>
    </div>
  </div>
</article>